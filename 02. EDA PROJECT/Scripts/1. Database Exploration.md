# Database Exploration üìä

A structured SQL script designed to **explore and document** the structure and storage of a Data Warehouse hosted on SQL Server.

> üí° This script targets the `ECommerceDatawarehouse` and focuses on metadata inspection, space usage analysis, and view exploration.

---

## üìå Purpose

- ‚úÖ Explore the list of **tables** and **views**.
- ‚úÖ Retrieve metadata of **columns**, **data types**, and **constraints**.
- ‚úÖ Calculate **table sizes** in MB.
- ‚úÖ Understand the structure and definitions of **views**.

---

## üóÉÔ∏è Table and View Listing

```sql
USE ECommerceDatawarehouse;
GO

-- Retrieve a list of all TABLES & VIEWS
SELECT TABLE_CATALOG,
       TABLE_SCHEMA,
       TABLE_NAME,
       TABLE_TYPE
FROM INFORMATION_SCHEMA.TABLES
ORDER BY TABLE_TYPE, TABLE_SCHEMA;
```

---

## üîé Column Metadata
```sql
-- Explore columns and their properties
SELECT
    s.name AS schema_name,
    t.name AS table_name,
    c.name AS column_name,
    ty.name AS data_type,
    c.max_length,
    c.precision,
    c.scale,
    c.is_nullable,
    c.is_identity,
    c.column_id,
    dc.definition AS default_value
FROM sys.columns c
INNER JOIN sys.tables t ON c.object_id = t.object_id
INNER JOIN sys.schemas s ON t.schema_id = s.schema_id
INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id
LEFT JOIN sys.default_constraints dc 
    ON c.default_object_id = dc.object_id
ORDER BY
    s.name, t.name, c.column_id;
```
---

## üì¶ Table Size Analysis (MB)
```sql
-- Table storage analysis
SELECT
    s.name AS SchemaName,
    t.name AS TableName,
    p.rows AS NumRows,
    CAST(ROUND(SUM(a.total_pages) / 128.0, 2) AS NUMERIC(36, 2)) AS Total_MB,
    CAST(ROUND(SUM(a.used_pages) / 128.0, 2) AS NUMERIC(36, 2)) AS Used_MB,
    CAST(ROUND((SUM(a.total_pages) - SUM(a.used_pages)) / 128.0, 2) AS NUMERIC(36, 2)) AS Unused_MB
FROM 
    sys.tables t
JOIN sys.indexes i ON t.object_id = i.object_id
JOIN sys.partitions p ON i.object_id = p.object_id AND i.index_id = p.index_id
JOIN sys.allocation_units a ON p.partition_id = a.container_id
LEFT JOIN sys.schemas s ON t.schema_id = s.schema_id
WHERE 
    t.name NOT LIKE 'dt%' -- Exclude system tables
    AND t.is_ms_shipped = 0 -- Exclude MS shipped objects
GROUP BY 
    s.name, t.name, p.rows
ORDER BY 
    Total_MB DESC, t.name;

-- üîç For a detailed analysis of a specific table it can be used the stored procedure sp_spaceused:
EXEC sp_spaceused 'bronze.crm_order_reviews';
```
---

## üëÅÔ∏è‚Äçüó®Ô∏è View Inspection
```sql
-- List views and definitions
SELECT
    s.name AS schema_name,
    v.name AS view_name,
    v.create_date,
    v.modify_date,
    m.definition AS view_definition
FROM sys.views v
INNER JOIN sys.schemas s ON v.schema_id = s.schema_id
LEFT JOIN sys.sql_modules m ON v.object_id = m.object_id
ORDER BY s.name, v.name;
```
---

## üß± View Columns Metadata
```sql
-- Metadata of columns in views
SELECT TABLE_NAME,
       COLUMN_NAME,
       DATA_TYPE,
       CHARACTER_MAXIMUM_LENGTH,
       IS_NULLABLE
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'gold';
```
---

## üìú View SQL Definitions
```sql
-- View the full SQL behind the following views
EXEC sp_helptext 'gold.fact_order_items';
EXEC sp_helptext 'gold.fact_orders';
EXEC sp_helptext 'gold.fact_reviews';
EXEC sp_helptext 'gold.dim_customers';
EXEC sp_helptext 'gold.dim_geolocation';
EXEC sp_helptext 'gold.dim_sellers';
EXEC sp_helptext 'gold.dim_products';
EXEC sp_helptext 'gold.fact_payments';
```



